{% extends "base.html" %}
{% block title %}Index{% endblock %}

{% block scripts %}
<script type="text/javascript">
  $(document).ready(function() {

    // Constructing the suggestion engine
    var categories = new Bloodhound({
        datumTokenizer: Bloodhound.tokenizers.whitespace,
        queryTokenizer: Bloodhound.tokenizers.whitespace,
        local: {{categories|tojson|safe}}
    });
    var suppliers = new Bloodhound({
        datumTokenizer: Bloodhound.tokenizers.whitespace,
        queryTokenizer: Bloodhound.tokenizers.whitespace,
        local: {{suppliers|tojson|safe}}
    });

    // Initializing the typeahead
    $('.categories').typeahead({
      hint: true,
      highlight: true,
      minLength: 1
    },
    {
      source: categories
    });
    $('.suppliers').typeahead({
      hint: true,
      highlight: true,
      minLength: 1
    },
    {
      source: suppliers
    });
  });
</script>
{% endblock %}

{% block content %}
        <div class="row">
            <div class="col-lg-12 text-center">
                <h1>Hi! I'm transaction #{{ transaction['id'] }}</h1>
                <p class="lead">Would you like to edit me or add some notes?</p>
            </div>
        </div>
        <!-- /.row -->

        <div class="row">
            <table id="table_id" class="table">
                <tbody>
                    <form id="edit" method="post" action="/transaction/{{ transaction['id'] }}">
                        <tr>
                            <th>Date</th>
                            <td><input name="day" form="edit" class="form-control" type="date"
                                value="{{ transaction['date'] }}"></td>
                            <td rowspan="4"><textarea name="notes" form="edit" class="form-control" rows="8"
                                {% if not transaction['notes'] %}
                                  placeholder="You can add notes here"
                                {% endif %}>{{ transaction['notes'] }}</textarea></td>
                        </tr>
                        <tr>
                            <th>Supplier</th>
                            <td><input name="supplier" form="edit" class="suppliers form-control" type="text"
                                value="{{ transaction['supplier'] }}"></td>
                        </tr>
                        <tr>
                            <th>Amount</th>
                            <td><input name="amount" form="edit" class="form-control" type="text"
                                value="{{ transaction['amount'] }}"></td>
                        </tr>
                        <tr>
                            <th>Category</th>
                            <td><input name="category" form="edit" class="categories form-control" type="text"
                                value="{{ transaction['category'] }}"></td>
                        </tr>
                    </form>
                        <tr>
                            <th>Actions</th>
                            <td>
                                <input type="submit" form="edit" value="Save changes" class="btn btn-success">
                                <form style="display: inline;" method="POST"
                                  action="/transaction/{{ transaction['id'] }}/delete">
                                    <input type="submit" class="btn btn-danger" value="Delete transaction">
                                </form>
                            </td>
                        </tr>
                    </tbody>
                </table>
        </div>

        <div class="row">
            <i>Last modified {{ transaction['last_modified'] }}</i>
        </div>
        <div class="row">
            <i>Created on {{ transaction['created_at'] }}</i>
        </div>
{% endblock %}
